---
import { Image } from 'astro:assets';
import { getEntry } from "astro:content";
import type { CollectionEntry } from "astro:content";

interface Props {
  taller: CollectionEntry<"talleres">;
}

const { taller } = Astro.props;
const { data, slug } = taller;

// Resolver Nombre Docente
let docenteNombre = data.docente_nombre;
if (data.docente) {
  const docenteEntry = await getEntry(data.docente);
  if (docenteEntry) docenteNombre = docenteEntry.data.nombre;
}

// Helper para normalizar nombres de categorías a clases CSS
const getCategoryClass = (cat: string) => {
  return cat
    .toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "")
    .replace(/\s+/g, "-");
};
---

<article class="card taller-card reveal">
  <div class={`card-image ${data.isFlyer ? 'flyer-mode' : ''}`}>
    {data.imagen ? (
      <Image src={data.imagen} alt={`Taller de ${data.titulo}`} />
    ) : (
      <div class="placeholder-image">
        <span>{data.titulo}</span>
      </div>
    )}
  </div>
  <div class="card-content">
    <h3 class="card-title">{data.titulo}</h3>
    
    <div class="card-meta">
      <span class="meta-item">
        <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
        {data.horarios}
      </span>
      <span class="meta-item">
        <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
        {data.edadNivel}
      </span>
      { docenteNombre && (
        <span class="meta-item">
          <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
          {docenteNombre}
        </span>
      )}
    </div>

    <div class="tags">
      {data.categorias.map(tag => (
        <span class={`badge badge-${getCategoryClass(tag)}`}>{tag}</span>
      ))}
    </div>

    <p class="card-description">{data.descripcion}</p>
    <a href={`/talleres/${slug}`} class="btn btn-primary full-width">Ver Taller</a>
  </div>
</article>

<style>
  .taller-card {
    display: flex;
    flex-direction: column;
    height: 100%;
  }

  .card-image {
    aspect-ratio: 16/9;
    overflow: hidden;
    background-color: var(--color-neutral-100);
  }

  .card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .card-image.flyer-mode {
    background-color: var(--color-primary-950); /* Dark background for posters */
  }

  .card-image.flyer-mode img {
    object-fit: contain;   /* Show full poster */
  }

  .taller-card:hover .card-image img {
    transform: scale(1.05);
  }

  .placeholder-image {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--color-primary-100);
    color: var(--color-primary-700);
    font-weight: bold;
    font-size: 1.2rem;
  }

  .card-content {
    padding: var(--space-6);
    display: flex;
    flex-direction: column;
    flex-grow: 1;
  }
.card {
  background: var(--color-surface);
  border-radius: var(--radius-xl);
  overflow: hidden;
  box-shadow: var(--shadow-md);
  transition: all var(--transition-normal);
  border: 1px solid transparent;
}

.card:hover {
  transform: translateY(-8px);
  box-shadow: var(--shadow-xl);
  border-color: var(--color-primary-200);
}
  .card-meta {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
    margin-bottom: var(--space-4);
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
  }

  .meta-item {
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  .card-title {
    font-size: var(--font-size-xl);
    margin-bottom: var(--space-2);
    color: var(--color-text-primary);
    overflow-wrap: break-word;
    word-break: break-word;
  }

  .card-description {
    margin-bottom: var(--space-6);
    line-height: 1.5;
    flex-grow: 1;
    overflow-wrap: anywhere;
    word-break: normal;
  }

  .full-width {
    width: 100%;
    text-align: center;
  }

  /* Tags */
  .tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: var(--space-4);
  }

  .badge {
    font-size: 0.75rem;
    color: white;
    background-color: var(--color-neutral-600);
    padding: 0.25rem 0.75rem;
    border-radius: 999px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  /* Colores por Categoría */
  .badge-musica { background-color: #0ea5e9; } /* Sky Blue */
  .badge-danza { background-color: #ec4899; } /* Pink */
  .badge-teatro { background-color: #f59e0b; color: white; } /* Amber/Gold */
  .badge-artes-visuales { background-color: #10b981; } /* Emerald */
  .badge-bienestar { background-color: #8b5cf6; } /* Violet */
  


</style>
