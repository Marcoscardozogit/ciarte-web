---
import { Image } from 'astro:assets';
import type { CollectionEntry } from "astro:content";

interface Props {
  actividad: CollectionEntry<"comunidad">;
}

const { actividad } = Astro.props;
const { data, slug } = actividad;

// Formatear fecha
const fecha = data.fecha ? new Date(data.fecha).toLocaleDateString("es-AR", {
  day: "numeric",
  month: "long",
  year: "numeric"
}) : null;

// Map de etiquetas legibles
const labels: Record<string, string> = {
    "encuentros": "Encuentros",
    "jornadas": "Jornadas",
    "arte-publico": "Arte Público",
    "celebraciones": "Celebraciones",
    "obras": "Obras",
    "integrantes": "Integrantes",
    "trayectoria": "Trayectoria",
    "otro": "Otro"
};
const displayLabel = labels[data.tipo] || data.tipo;
---

<article class="card comunidad-card reveal">
  <div class="card-image">
    {data.imagen ? (
      <Image src={data.imagen} alt={data.titulo} />
    ) : (
      <div class={`placeholder-image type-${data.tipo}`}>
        <span>{data.tipo}</span>
      </div>
    )}
  </div>
  <div class="card-content">
    <div class="card-header">
      <span class={`badge type-${data.tipo}`}>{displayLabel}</span>
      {fecha && <span class="date">{fecha}</span>}
    </div>
    <h3 class="card-title">{data.titulo}</h3>
    <p class="card-description">{data.descripcion}</p>
    <div style="margin-top: auto; padding-top: var(--space-4);">
        <a href={`/comunidad/${slug}`} class="btn-link">Ver más →</a>
    </div>
  </div>
</article>

<style>
  .comunidad-card {
    display: flex;
    flex-direction: column;
    height: 100%;
  }

  .card-image {
    aspect-ratio: 16/9;
    overflow: hidden;
    background-color: var(--color-neutral-100);
  }

  .card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .comunidad-card:hover .card-image img {
    transform: scale(1.05);
  }

  .placeholder-image {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--color-secondary-100);
    color: var(--color-secondary-800);
    font-weight: bold;
    text-transform: uppercase;
  }

  .placeholder-image.type-mural { background-color: var(--color-accent-100); color: var(--color-accent-800); }
  .placeholder-image.type-celebracion { background-color: var(--color-primary-100); color: var(--color-primary-800); }

  .card-content {
    padding: var(--space-6);
    display: flex;
    flex-direction: column;
    flex-grow: 1;
  }

  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-3);
  }

  .badge {
    padding: 0.25rem 0.75rem;
    border-radius: var(--radius-full);
    font-size: var(--font-size-xs);
    font-weight: bold;
    text-transform: uppercase;
    background-color: var(--color-neutral-200);
    color: var(--color-text-secondary);
  }

  .badge.type-encuentro, .badge.type-encuentros { background-color: var(--color-primary-600); color: white; }
  .badge.type-mural, .badge.type-arte-publico { background-color: var(--color-accent-700); color: white; }
  .badge.type-celebracion, .badge.type-celebraciones { background-color: #8b5cf6; color: white; } /* Violeta para celebraciones */
  .badge.type-jornada, .badge.type-jornadas { background-color: var(--color-neutral-700); color: white; }
  .badge.type-obra, .badge.type-obras { background-color: var(--color-primary-800); color: white; border: 1px solid var(--color-accent-400); }
  .badge.type-integrantes { background-color: var(--color-neutral-600); color: white; }
  .badge.type-trayectoria { background-color: var(--color-accent-600); color: white; }

  .date {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
  }

  .card-title {
    font-size: var(--font-size-lg);
    margin-bottom: var(--space-3);
    color: var(--color-text-primary);
  }

  .card-description {
    color: var(--color-text-secondary);
    font-size: var(--font-size-sm);
    margin-bottom: 0;
  }

  .btn-link {
    color: var(--color-primary-500);
    font-weight: bold;
    text-decoration: none;
    font-size: var(--font-size-sm);
    transition: color 0.2s;
  }

  .btn-link:hover {
    color: var(--color-primary-600);
    text-decoration: underline;
  }

  .btn-link:hover {
    color: var(--color-primary-600);
    text-decoration: underline;
  }
</style>
