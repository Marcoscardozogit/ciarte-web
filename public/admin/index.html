<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />
  <title>CIArte CMS - Panel de Administración</title>
  <!-- Netlify Identity Widget -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <style>
    /* Reset global para evitar scroll horizontal fantasma */
    body,
    html {
      max-width: 100vw;
      overflow-x: hidden;
    }

    /* =========================================
       DISEÑO MÓVIL (Max 800px)
       Objetivo: Sidebar arriba, Contenido abajo
       ========================================= */
    @media (max-width: 800px) {

      /* 1. Contenedor Principal: Cambiar de Row a Column */
      div[class*="AppMainContainer"] {
        display: flex !important;
        flex-direction: column !important;
        width: 100% !important;
        min-width: 0 !important;
      }

      /* 2. Barra Lateral (Colecciones): Pegada arriba y ancho completo */
      div[class*="SidebarContainer"],
      aside {
        width: 100% !important;
        min-width: 100% !important;
        height: auto !important;
        position: relative !important;
        display: block !important;
        border-right: none !important;
        border-bottom: 1px solid #444;
        padding: 10px !important;
        flex-shrink: 0 !important;
      }

      div[class*="SidebarLink"] {
        padding-left: 0 !important;
      }

      /* 3. Área de Contenido: Abajo y ancho completo */
      div[class*="CollectionMainContainer"],
      main {
        width: 100% !important;
        min-width: 100% !important;
        margin-left: 0 !important;
        padding: 5px !important;
        display: block !important;
      }

      div[class*="CollectionPageHeader"] {
        padding-left: 0 !important;
        margin-left: 0 !important;
      }

      div[class*="CardGrid"] {
        margin-left: 0 !important;
        width: 100% !important;
        display: grid !important;
        grid-template-columns: 1fr !important;
        gap: 10px !important;
      }

      a[class*="Card"] {
        width: 100% !important;
        max-width: 100% !important;
        margin: 0 !important;
      }
    }
  </style>
</head>

<body>
  <!-- Decap CMS App -->
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  <script>
    // Registrar estilos para el interior del iframe de previsualización
    CMS.registerPreviewStyle("/admin/preview.css");

    // Solución para el problema de "Reactividad" en el Local Backend
    // Forzamos una recarga o redirección al guardar para que la lista se actualice
    CMS.registerEventListener({
      name: 'postSave',
      handler: ({ entry }) => {
        console.log("Guardado detectado, preparando actualización de lista...");
        // Pequeño truco: después de guardar, esperamos un momento y volvemos a la lista
        // Esto asegura que el Redux store del CMS se limpie y cargue los nuevos datos
        setTimeout(() => {
          const collection = entry.get('collection');
          if (collection) {
            window.location.hash = `#/collections/${collection}`;
            // Forzamos un refresh si estamos en local para evitar cache persistente
            window.location.reload();
          }
        }, 500);
      },
    });
  </script>
</body>

</html>