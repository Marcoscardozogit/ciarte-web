<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />
  <title>CIArte CMS - Panel de Administración</title>
  <!-- Netlify Identity Widget -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <style>
    /* Corregir desbordamiento del editor y previsualización */
    div[class*="SplitPane"] {
      max-width: 100vw !important;
    }

    div[class*="Pane2"] {
      overflow-x: hidden !important;
    }

    /* Asegurar que el contenedor principal no genere scroll horizontal */
    body {
      overflow-x: hidden;
    }
  </style>
</head>

<body>
  <!-- Decap CMS App -->
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  <script>
    // Registrar estilos para el interior del iframe de previsualización
    CMS.registerPreviewStyle("/admin/preview.css");

    // Solución para el problema de "Reactividad" en el Local Backend
    // Forzamos una recarga o redirección al guardar para que la lista se actualice
    CMS.registerEventListener({
      name: 'postSave',
      handler: ({ entry }) => {
        console.log("Guardado detectado, preparando actualización de lista...");
        // Pequeño truco: después de guardar, esperamos un momento y volvemos a la lista
        // Esto asegura que el Redux store del CMS se limpie y cargue los nuevos datos
        setTimeout(() => {
          const collection = entry.get('collection');
          if (collection) {
            window.location.hash = `#/collections/${collection}`;
            // Forzamos un refresh si estamos en local para evitar cache persistente
            window.location.reload();
          }
        }, 500);
      },
    });
  </script>
</body>

</html>